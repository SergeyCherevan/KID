# Рефакторинг части архитектуры

## Контекст
Выполняет рефакторинг части архитектуры проекта .KID для улучшения читаемости, поддерживаемости и следования лучшим практикам.

## Задача
Выполни рефакторинг части архитектуры: {{target}}

### Анализ текущего состояния

1. **Изучение кода**
   - Прочитай все файлы в указанной части архитектуры
   - Проанализируй структуру и зависимости
   - Выяви проблемы и области для улучшения

2. **Выявление проблем**
   Определи следующие проблемы:
   - Нарушения принципов SOLID
   - Дублирование кода
   - Слишком большие методы или классы
   - Нарушения DRY (Don't Repeat Yourself)
   - Плохая обработка ошибок
   - Отсутствие документации
   - Нарушения паттернов проекта

### План рефакторинга

3. **Создание плана**
   Создай план рефакторинга, который включает:
   - Список выявленных проблем
   - Предлагаемые решения
   - Порядок выполнения изменений
   - Оценку влияния на другие части проекта

### Выполнение рефакторинга

4. **Рефакторинг кода**
   Выполни следующие улучшения:

   **Структура:**
   - Разбей большие методы на меньшие
   - Вынеси общую логику в отдельные методы
   - Создай базовые классы если необходимо
   - Улучши организацию кода

   **Обработка ошибок:**
   - Добавь try-catch где необходимо
   - Улучши сообщения об ошибках
   - Добавь валидацию входных параметров
   - Используй проверки на null

   **Документация:**
   - Добавь XML-комментарии ко всем публичным членам
   - Обнови существующие комментарии
   - Добавь примеры использования где уместно

   **Паттерны:**
   - Убедись в правильном использовании MVVM
   - Проверь использование DI
   - Улучши использование команд (ICommand)
   - Оптимизируй использование async/await

   **Производительность:**
   - Оптимизируй операции с UI (используй BeginInvoke где возможно)
   - Улучши использование памяти
   - Оптимизируй загрузку ресурсов

5. **Проверка совместимости**
   - Убедись, что изменения не нарушают существующую функциональность
   - Проверь, что все зависимости правильно обновлены
   - Убедись, что интерфейсы не изменились (или обнови все использования)

6. **Обновление документации**
   Если архитектура изменилась:
   - Обнови ARCHITECTURE.md
   - Обнови SUBSYSTEMS.md если затронуты подсистемы
   - Обнови DEVELOPMENT.md если изменились практики

## Требования
- Сохрани всю существующую функциональность
- Не меняй публичные API без необходимости
- Следуй существующему стилю кода
- Улучши читаемость и поддерживаемость
- Следуй принципам SOLID
- Добавь необходимую документацию
- Улучши обработку ошибок
- Оптимизируй производительность где возможно

## Области для рефакторинга

Возможные значения {{target}}:
- `services` - все сервисы
- `viewmodels` - все ViewModels
- `views` - все Views
- `code-execution` - подсистема выполнения кода
- `localization` - подсистема локализации
- `themes` - подсистема тем
- `graphics-api` - Graphics API
- `files` - подсистема работы с файлами
- Или конкретный путь к файлу/папке

## Отчёт о рефакторинге
После выполнения предоставь отчёт:
- Список выявленных проблем
- Выполненные улучшения
- Изменённые файлы
- Обновлённая документация
- Рекомендации для дальнейшего улучшения

