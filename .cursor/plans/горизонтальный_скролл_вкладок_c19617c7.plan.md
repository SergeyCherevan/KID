---
name: Горизонтальный скролл вкладок
overview: Добавить горизонтальную прокрутку полосы вкладок редактора при переполнении по ширине, приоритетно только через XAML без изменений C#-кода. План учитывает MVVM/DI архитектуру проекта и актуальные стили тем.
todos: []
isProject: false
---

# План реализации горизонтальной прокрутки вкладок

## 1. Анализ требований

1. **Описание функции и цель**
  - При превышении суммарной ширины вкладок доступной ширины панели должна отображаться горизонтальная полоса прокрутки.
  - Цель: сохранить удобство работы с большим числом открытых файлов без сжатия/ломки текущего поведения вкладок.
2. **Целевая аудитория и сценарии**
  - Пользователи редактора кода в `.KID`, которые работают с множеством открытых файлов.
  - Сценарий: открыто много вкладок -> панель вкладок переполняется -> пользователь прокручивает список вкладок по горизонтали.
3. **Входные и выходные данные**
  - Вход: коллекция `OpenedFiles` из `CodeEditorsViewModel`.
  - Выход: корректное визуальное поведение панели вкладок (горизонтальный скролл при overflow).
4. **Ограничения и требования**
  - Предпочтительно реализовать только в XAML (без C#-кода).
  - Не менять текущую логику выбора/закрытия/перемещения вкладок.
  - Сохранить совместимость со светлой и тёмной темами.

## 2. Архитектурный анализ

1. **Затронутые подсистемы**
  - UI представление вкладок: [KID.WPF.IDE/Views/CodeEditorsView.xaml](KID.WPF.IDE/Views/CodeEditorsView.xaml)
  - Тема/визуал вкладок: [KID.WPF.IDE/Themes/DarkTheme.xaml](KID.WPF.IDE/Themes/DarkTheme.xaml), [KID.WPF.IDE/Themes/LightTheme.xaml](KID.WPF.IDE/Themes/LightTheme.xaml)
  - Документация (при необходимости): [docs/FEATURES.md](docs/FEATURES.md) или профильный документ по UI/редактору.
2. **Новые компоненты**
  - Новые C#-компоненты не требуются.
  - Возможен локальный XAML-стиль/настройка для `ScrollViewer` панели вкладок.
3. **Изменяемые компоненты**
  - Основное изменение: разметка секции `ItemsControl` вкладок в `CodeEditorsView.xaml`.
  - Ключевая идея: обернуть `ItemsControl` в `ScrollViewer` с `HorizontalScrollBarVisibility="Auto"` и `VerticalScrollBarVisibility="Disabled"`.
4. **Зависимости между компонентами**
  - `OpenedFiles` и команды во `ViewModel` остаются без изменений (MVVM не затрагивается).
  - Триггеры активной вкладки, кнопки закрытия и контекстное меню продолжают работать, т.к. DataTemplate вкладки сохраняется.

## 3. Список задач

1. **Изменить XAML панели вкладок**
  - Файл: [KID.WPF.IDE/Views/CodeEditorsView.xaml](KID.WPF.IDE/Views/CodeEditorsView.xaml)
  - Действия:
    - добавить `ScrollViewer` вокруг `ItemsControl` вкладок;
    - включить горизонтальный скролл `Auto`;
    - отключить вертикальный скролл;
    - оставить горизонтальный `StackPanel` в `ItemsPanelTemplate`.
2. **Проверить влияние на стили/темы**
  - Файлы: [KID.WPF.IDE/Themes/DarkTheme.xaml](KID.WPF.IDE/Themes/DarkTheme.xaml), [KID.WPF.IDE/Themes/LightTheme.xaml](KID.WPF.IDE/Themes/LightTheme.xaml)
  - Проверка:
    - отсутствие конфликтующих стилей `ScrollViewer`/`ItemsControl`;
    - корректная визуализация полосы вкладок в обеих темах.
3. **Локализация**
  - Новые локализуемые строки не добавляются.
  - `.resx` файлы не меняются.
4. **Документация**
  - Обновить краткое описание поведения вкладок в документации (если есть релевантный раздел), указав появление горизонтальной прокрутки при переполнении.
5. **Тестирование**
  - Ручные проверки:
    - открыть большое число файлов до переполнения ширины;
    - убедиться в появлении горизонтального скролла;
    - проверить выбор вкладки кликом, закрытие `×`, контекстное меню;
    - проверить команды перемещения вкладок влево/вправо;
    - проверить поведение в обеих темах.

## 4. Порядок выполнения

1. Подготовить изменение только в `CodeEditorsView.xaml` (XAML-only).
2. Добавить `ScrollViewer` для полосы вкладок.
3. Прогнать визуальную проверку в light/dark теме.
4. Проверить, что логика вкладок (select/close/move) не регрессировала.
5. При необходимости обновить документацию и зафиксировать итог.

## 5. Оценка сложности

1. **XAML-изменение панели вкладок**
  - Сложность: низкая
  - Время: 15-25 минут
  - Риски: неправильная ширина контента внутри `ScrollViewer`, из-за чего скролл может не появляться.
2. **Проверка визуала в темах**
  - Сложность: низкая
  - Время: 10-15 минут
  - Риски: возможные визуальные артефакты полосы прокрутки на фоне панели вкладок.
3. **Ручное регрессионное тестирование вкладок**
  - Сложность: низкая-средняя
  - Время: 20-30 минут
  - Риски: мелкие UX-особенности при большом количестве вкладок (например, неудобное положение активной вкладки после скролла).
4. **Обновление документации**
  - Сложность: низкая
  - Время: 5-10 минут
  - Риски: отсутствие явного целевого раздела в docs.

## Техническая стратегия (предпочтительная)

- Реализация только через XAML в [KID.WPF.IDE/Views/CodeEditorsView.xaml](KID.WPF.IDE/Views/CodeEditorsView.xaml):
  - `ScrollViewer HorizontalScrollBarVisibility="Auto"`
  - `ScrollViewer VerticalScrollBarVisibility="Disabled"`
  - существующий `ItemsControl` и его `DataTemplate` вкладок без изменений в C#.
- Это соответствует ограничению «без C#-кода» и минимизирует риски регрессий в `CodeEditorsViewModel`.

