<Window x:Class="KID.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:avalonedit="http://icsharpcode.net/sharpdevelop/avalonedit"
        xmlns:views="clr-namespace:KID.Views"
        xmlns:viewModels="clr-namespace:KID.ViewModels"
        xmlns:viewModelsInterfaces="clr-namespace:KID.ViewModels.Interfaces"
        xmlns:local="clr-namespace:KID"
        xmlns:di="clr-namespace:KID.Services.DI"
        xmlns:localization="clr-namespace:KID.Services.Localization"
        xmlns:converters="clr-namespace:KID.Converters"
        xmlns:shell="clr-namespace:System.Windows.Shell;assembly=PresentationFramework"
        Title="{localization:Localization Window_Title}"
        Height="600" Width="800"
        WindowState="{Binding WindowState, Mode=TwoWay}"
        WindowStyle="None"
        AllowsTransparency="False" 
        ResizeMode="CanResize"
        Icon="Resources/KID.ico"
        Background="{DynamicResource SpecialElementsBrush}">

    <Window.DataContext>
        <di:ServiceProviderExtension ServiceType="{x:Type viewModelsInterfaces:IMainViewModel}" />
    </Window.DataContext>

    <Window.Resources>
        <converters:WindowStateToMarginConverter x:Key="WindowStateToMarginConverter" />
    </Window.Resources>

    <Window.InputBindings>
        <KeyBinding Key="N" Modifiers="Ctrl" Command="{Binding DataContext.NewFileCommand, ElementName=MenuView}" />
        <KeyBinding Key="O" Modifiers="Ctrl" Command="{Binding DataContext.OpenFileCommand, ElementName=MenuView}" />
        <KeyBinding Key="S" Modifiers="Ctrl" Command="{Binding DataContext.SaveFileCommand, ElementName=MenuView}" />
        <KeyBinding Key="S" Modifiers="Ctrl+Shift" Command="{Binding DataContext.SaveAsFileCommand, ElementName=MenuView}" />
        <KeyBinding Key="F5" Modifiers="Ctrl" Command="{Binding DataContext.RunCommand, ElementName=MenuView}" />
        <KeyBinding Key="F5" Modifiers="Shift" Command="{Binding DataContext.StopCommand, ElementName=MenuView}" />
        <KeyBinding Key="Z" Modifiers="Ctrl" Command="{Binding DataContext.UndoCommand, ElementName=MenuView}" />
        <KeyBinding Key="Y" Modifiers="Ctrl" Command="{Binding DataContext.RedoCommand, ElementName=MenuView}" />
    </Window.InputBindings>

    <Window.Style>
        <Style TargetType="Window">
            <Setter Property="shell:WindowChrome.WindowChrome">
                <Setter.Value>
                    <shell:WindowChrome CaptionHeight="0"
                                       ResizeBorderThickness="5"
                                       GlassFrameThickness="0,0,0,0"/>
                </Setter.Value>
            </Setter>
        </Style>
    </Window.Style>

    <Border BorderBrush="{DynamicResource WindowBorderBrush}"
            BorderThickness="1"
            Margin="{Binding WindowState, Converter={StaticResource WindowStateToMarginConverter}}">
        <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="32"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>

        <!-- Заголовок -->
        <Border Grid.Row="0"
                Background="{DynamicResource WindowBrush}"
                Height="32">
            <DockPanel LastChildFill="True">
                <DockPanel.InputBindings>
                    <MouseBinding Gesture="LeftClick"
                                Command="{Binding DragMoveCommand}"/>
                </DockPanel.InputBindings>
                <Image Source="Resources/KID.ico"
                       Width="30" Height="30"
                       Margin="7.5,0,0,0"
                       VerticalAlignment="Center" />
                <StackPanel Orientation="Horizontal"
                            DockPanel.Dock="Right"
                            VerticalAlignment="Center">
                    <Button Name="MinimizeButton" 
                            Style="{DynamicResource WindowButtonStyle}" 
                            Command="{Binding MinimizeCommand}" 
                            Content="—"/>
                    <Button Name="MaximizeButton" 
                            Style="{DynamicResource WindowButtonStyle}" 
                            Command="{Binding MaximizeCommand}" 
                            Content="{Binding MaximizeButtonContent}"/>
                    <Button Name="CloseButton" 
                            Style="{DynamicResource WindowButtonStyle}" 
                            Command="{Binding CloseCommand}"
                            CommandParameter="{Binding RelativeSource={RelativeSource AncestorType=Window}}"
                            Content="╳"/>
                </StackPanel>
                <TextBlock Text="{localization:Localization Window_Title}"
                           DockPanel.Dock="Left"
                           Foreground="{DynamicResource TitleBrush}"
                           VerticalAlignment="Center"
                           FontWeight="Bold"
                           FontSize="13"
                           Margin="7.5,0,0,0"/>
            </DockPanel>
        </Border>

        <!-- Меню -->
        <views:MenuView x:Name="MenuView" Grid.Row="1" />

        <!-- Рабочая зона -->
        <Grid x:Name="WorkspaceGrid" Grid.Row="2">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*" />
                <ColumnDefinition Width="5" />
                <ColumnDefinition Width="310" MinWidth="310" />
            </Grid.ColumnDefinitions>

            <!-- Код -->
            <views:CodeEditorsView x:Name="CodeEditorsView" Grid.Column="0" Margin="0" />

            <!-- Разделитель -->
            <GridSplitter Grid.Column="1" Width="5"
                          HorizontalAlignment="Center"
                          VerticalAlignment="Stretch"
                          Background="{DynamicResource SplitterBrush}" />

            <!-- Вывод -->
            <Grid x:Name="OutputGrid" Grid.Column="2" Margin="5">
                <Grid.RowDefinitions>
                    <RowDefinition Height="*" />
                    <RowDefinition Height="5" />
                    <RowDefinition MinHeight="300" />
                </Grid.RowDefinitions>

                <!-- Консоль -->
                <views:ConsoleOutputView x:Name="ConsoleOutputView" Grid.Row="0" />

                <!-- Вертикальный разделитель -->
                <GridSplitter Grid.Row="1"
                              Height="5"
                              HorizontalAlignment="Stretch"
                              VerticalAlignment="Center"
                              Background="{DynamicResource SplitterBrush}" />

                <!-- Графика -->
                <views:GraphicsOutputView x:Name="GraphicsOutputView" Grid.Row="2" />
            </Grid>
        </Grid>
        </Grid>
    </Border>
</Window>
