<UserControl x:Class="KID.Views.MenuView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:viewModels="clr-namespace:KID.ViewModels"
             xmlns:viewModelsInterfaces="clr-namespace:KID.ViewModels.Interfaces"
             xmlns:di="clr-namespace:KID.Services.DI"
             xmlns:converters="clr-namespace:KID.Converters"
             xmlns:localization="clr-namespace:KID.Services.Localization"
             Height="Auto" Width="Auto">

    <UserControl.Resources>
        <converters:InverseBooleanConverter x:Key="InverseBooleanConverter" />
        <converters:EqualityToBoolConverter x:Key="EqualityToBoolConverter" />
        <converters:LocalizationKeyToTextConverter x:Key="LocalizationKeyToTextConverter" />
    </UserControl.Resources>

    <UserControl.DataContext>
        <di:ServiceProviderExtension ServiceType="{x:Type viewModelsInterfaces:IMenuViewModel}" />
    </UserControl.DataContext>

    <StackPanel Orientation="Horizontal" Background="{DynamicResource MenuBrush}">
        <Menu Margin="0,0,0,10">
            <MenuItem Header="{localization:Localization Menu_File}">
                <MenuItem Header="{localization:Localization Menu_New}" InputGestureText="Ctrl+N" Command="{Binding NewFileCommand}" />
                <MenuItem Header="{localization:Localization Menu_Open}" InputGestureText="Ctrl+O" Command="{Binding OpenFileCommand}" />
                <MenuItem Header="{localization:Localization Menu_Save}" InputGestureText="Ctrl+S" Command="{Binding SaveFileCommand}" />
                <MenuItem Header="{localization:Localization Menu_SaveAs}" InputGestureText="Ctrl+Shift+S" Command="{Binding SaveAsFileCommand}" />
                <MenuItem Header="{localization:Localization TabContext_SaveAndSetAsTemplate}"
                          Command="{Binding SaveAndSetAsTemplateCommand}" />
            </MenuItem>
            <MenuItem Header="{localization:Localization Menu_Edit}">
                <MenuItem Header="{localization:Localization Menu_Undo}" InputGestureText="Ctrl+Z" Command="{Binding UndoCommand}" IsEnabled="{Binding CanUndo}" />
                <MenuItem Header="{localization:Localization Menu_Redo}" InputGestureText="Ctrl+Y" Command="{Binding RedoCommand}" IsEnabled="{Binding CanRedo}" />
            </MenuItem>
            <MenuItem Header="{localization:Localization Menu_View}">
                <MenuItem Header="{localization:Localization Menu_Theme}" 
                         ItemsSource="{Binding AvailableThemes}">
                    <MenuItem.ItemContainerStyle>
                        <Style TargetType="MenuItem">
                            <Setter Property="Header">
                                <Setter.Value>
                                    <MultiBinding Converter="{StaticResource LocalizationKeyToTextConverter}" Mode="OneWay">
                                        <Binding Path="." />
                                        <Binding Path="DataContext.SelectedCultureCode" RelativeSource="{RelativeSource AncestorType=UserControl}" />
                                    </MultiBinding>
                                </Setter.Value>
                            </Setter>
                            <Setter Property="IsCheckable" Value="True" />
                            <Setter Property="Command" Value="{Binding DataContext.ChangeThemeCommand, RelativeSource={RelativeSource AncestorType=UserControl}}" />
                            <Setter Property="CommandParameter" Value="{Binding}" />
                            <Setter Property="IsChecked">
                                <Setter.Value>
                                    <MultiBinding Converter="{StaticResource EqualityToBoolConverter}" Mode="OneWay">
                                        <Binding Path="DataContext.SelectedThemeKey" RelativeSource="{RelativeSource AncestorType=UserControl}" />
                                        <Binding Path="." />
                                    </MultiBinding>
                                </Setter.Value>
                            </Setter>
                        </Style>
                    </MenuItem.ItemContainerStyle>
                </MenuItem>
                <MenuItem Header="{localization:Localization Menu_ChangeLanguage}" 
                         ItemsSource="{Binding AvailableLanguages}">
                    <MenuItem.ItemContainerStyle>
                        <Style TargetType="MenuItem">
                            <Setter Property="Header">
                                <Setter.Value>
                                    <MultiBinding Converter="{StaticResource LocalizationKeyToTextConverter}" Mode="OneWay">
                                        <Binding Path="." />
                                        <Binding Path="DataContext.SelectedCultureCode" RelativeSource="{RelativeSource AncestorType=UserControl}" />
                                    </MultiBinding>
                                </Setter.Value>
                            </Setter>
                            <Setter Property="IsCheckable" Value="True" />
                            <Setter Property="Command" Value="{Binding DataContext.ChangeLanguageCommand, RelativeSource={RelativeSource AncestorType=UserControl}}" />
                            <Setter Property="CommandParameter" Value="{Binding}" />
                            <Setter Property="IsChecked">
                                <Setter.Value>
                                    <MultiBinding Converter="{StaticResource EqualityToBoolConverter}" Mode="OneWay">
                                        <Binding Path="DataContext.SelectedLanguageKey" RelativeSource="{RelativeSource AncestorType=UserControl}" />
                                        <Binding Path="." />
                                    </MultiBinding>
                                </Setter.Value>
                            </Setter>
                        </Style>
                    </MenuItem.ItemContainerStyle>
                </MenuItem>
                <MenuItem Header="{localization:Localization Menu_Font}" 
                         ItemsSource="{Binding AvailableFonts}">
                    <MenuItem.ItemContainerStyle>
                        <Style TargetType="MenuItem">
                            <Setter Property="Header" Value="{Binding}" />
                            <Setter Property="IsCheckable" Value="True" />
                            <Setter Property="Command" Value="{Binding DataContext.ChangeFontCommand, RelativeSource={RelativeSource AncestorType=UserControl}}" />
                            <Setter Property="CommandParameter" Value="{Binding}" />
                            <Setter Property="IsChecked">
                                <Setter.Value>
                                    <MultiBinding Converter="{StaticResource EqualityToBoolConverter}" Mode="OneWay">
                                        <Binding Path="DataContext.SelectedFontFamily" RelativeSource="{RelativeSource AncestorType=UserControl}" />
                                        <Binding Path="." />
                                    </MultiBinding>
                                </Setter.Value>
                            </Setter>
                        </Style>
                    </MenuItem.ItemContainerStyle>
                </MenuItem>
                <MenuItem Header="{localization:Localization Menu_FontSize}" 
                         ItemsSource="{Binding AvailableFontSizes}">
                    <MenuItem.ItemContainerStyle>
                        <Style TargetType="MenuItem">
                            <Setter Property="Header" Value="{Binding}" />
                            <Setter Property="IsCheckable" Value="True" />
                            <Setter Property="Command" Value="{Binding DataContext.ChangeFontSizeCommand, RelativeSource={RelativeSource AncestorType=UserControl}}" />
                            <Setter Property="CommandParameter" Value="{Binding}" />
                            <Setter Property="IsChecked">
                                <Setter.Value>
                                    <MultiBinding Converter="{StaticResource EqualityToBoolConverter}" Mode="OneWay">
                                        <Binding Path="DataContext.SelectedFontSize" RelativeSource="{RelativeSource AncestorType=UserControl}" />
                                        <Binding Path="." />
                                    </MultiBinding>
                                </Setter.Value>
                            </Setter>
                        </Style>
                    </MenuItem.ItemContainerStyle>
                </MenuItem>
            </MenuItem>
            <MenuItem Header="{localization:Localization Menu_Run}" InputGestureText="Ctrl+F5" Command="{Binding RunCommand}" IsEnabled="{Binding CanStop, Converter={StaticResource InverseBooleanConverter}}" />
            <MenuItem Header="{localization:Localization Menu_Stop}" InputGestureText="Shift+F5" Command="{Binding StopCommand}" IsEnabled="{Binding CanStop}" />
        </Menu>
    </StackPanel>
</UserControl>
