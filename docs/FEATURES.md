# Функциональность проекта .KID

## Обзор возможностей

.KID предоставляет полный набор функций для обучения программированию на C# с визуальным выводом и консольным вводом/выводом.

## 1. Редактор кода

### Основные возможности

- **Подсветка синтаксиса C#**
  - Автоматическое выделение ключевых слов, строк, комментариев
  - Настраиваемые цветовые схемы через темы оформления
  - Основан на AvalonEdit

- **Отмена и повтор действий (Undo/Redo)**
  - Полная история изменений
  - Горячие клавиши и команды меню
  - Визуальная индикация доступности операций

- **Настройки редактора**
  - Выбор семейства шрифта
  - Настройка размера шрифта
  - Сохранение настроек между сеансами

- **Автоматическое форматирование**
  - Поддержка стандартного форматирования C#

### Интерфейс редактора

- Разделяемая панель с консолью и графикой
- Возможность изменения размера панелей
- Полноэкранный режим редактирования

## 2. Выполнение кода

### Компиляция

- **Компиляция в реальном времени**
  - Использование Microsoft.CodeAnalysis
  - Быстрая компиляция C# кода
  - Обработка ошибок компиляции

- **Обработка ошибок**
  - Отображение ошибок с указанием номера строки
  - Локализованные сообщения об ошибках
  - Подробная информация об ошибках

- **Специальная обработка Console.Clear()**
  - Автоматическая замена на TextBoxConsole.StaticConsole.Clear()
  - Прозрачная для пользователя

### Выполнение

- **Запуск программы**
  - Кнопка "▶️ Запустить" в меню
  - Горячие клавиши (если настроены)
  - Автоматическая очистка консоли и графики перед запуском

- **Остановка программы**
  - Кнопка "■ Стоп" в меню
  - Безопасная отмена выполнения
  - Сообщение об остановке программы

- **Обработка исключений**
  - Отображение сообщений об ошибках выполнения
  - Вывод стека вызовов при ошибках
  - Локализованные сообщения

- **Потокобезопасность**
  - Выполнение в отдельном потоке
  - Безопасный доступ к UI элементам
  - Поддержка CancellationToken

## 3. Воспроизведение звуков

### Music API

Полный набор функций для воспроизведения звуков и музыки (см. [Music API](Music-API.md) для подробностей):

- **Базовое воспроизведение**
  - Воспроизведение тонов заданной частоты и длительности
  - Последовательности звуков через структуру `SoundNote`
  - Полифоническое воспроизведение (несколько дорожек одновременно)

- **Работа со звуками**
  - Структура `SoundNote` с полями `Frequency`, `DurationMs`, `Volume`
  - Индивидуальная громкость для каждого звука
  - Поддержка пауз (тишины)

- **Проигрывание файлов**
  - Воспроизведение аудиофайлов (WAV, MP3 и др.)
  - Поддержка локальных путей и URL
  - Блокирующее и асинхронное воспроизведение

- **Расширенное управление**
  - Асинхронное воспроизведение через `SoundPlay()`
  - Управление несколькими звуками одновременно
  - Пауза, остановка, зацикливание
  - Плавное изменение громкости (fade)

- **Управление громкостью**
  - Глобальная громкость через `Music.Volume` (0-10)
  - Индивидуальная громкость для каждого звука

### Особенности

- **Автоматическая синхронизация**
  - Все операции выполняются безопасно
  - Интеграция с StopManager для отмены

- **Типобезопасность**
  - Использование структуры `SoundNote` вместо массивов чисел
  - Явная структура данных для читаемости кода

- **Гибкость**
  - Блокирующее и асинхронное воспроизведение
  - Поддержка различных форматов аудио
  - Полифоническое воспроизведение с микшированием

## 4. Графический вывод

### Graphics API

Полный набор функций для рисования (см. [Graphics API](Graphics-API.md) для подробностей):

- **Простые фигуры**
  - Круги (`Circle`)
  - Эллипсы (`Ellipse`)
  - Прямоугольники (`Rectangle`)
  - Линии (`Line`)
  - Многоугольники (`Polygon`)

- **Кривые Безье**
  - Квадратичные кривые (3 точки)
  - Кубические кривые (4 точки)

- **Работа с текстом**
  - Вывод текста на холст
  - Настройка шрифта и размера
  - Изменение текста после создания

- **Работа с цветами**
  - Поддержка различных форматов (строки, RGB, hex)
  - Отдельные цвета для заливки и обводки
  - Универсальный цвет для обеих операций

- **Методы расширения**
  - Позиционирование фигур
  - Изменение размеров
  - Изменение цветов
  - Управление на холсте

### Особенности

- **Автоматическая синхронизация с UI**
  - Все операции выполняются в UI потоке
  - Безопасность при работе из разных потоков

- **Интерактивность**
  - Возможность модификации фигур после создания
  - Цепочки вызовов методов
  - Возврат объектов для дальнейшей работы

- **Очистка холста**
  - Метод `Graphics.Clear()` для очистки
  - Автоматическая очистка перед запуском программы

## 5. Консольный ввод/вывод

### Вывод

- **Console.WriteLine / Console.Write**
  - Полная поддержка стандартных методов
  - Автоматическое перенаправление в TextBox
  - Поддержка форматирования строк

- **Console.Error**
  - Перенаправление ошибок в тот же TextBox
  - Визуально не отличается от обычного вывода

- **Очистка консоли**
  - `Console.Clear()` очищает TextBox
  - Автоматическая замена на TextBoxConsole.StaticConsole.Clear()

### Ввод

- **Console.ReadLine()**
  - Полная поддержка ввода строк
  - Обработка Backspace для удаления символов
  - Поддержка Enter для завершения ввода
  - Поддержка кириллицы и Unicode

- **Console.Read()**
  - Чтение одного символа
  - Блокирующий ввод
  - Визуальная обратная связь (фокус на TextBox)

### Особенности

- **Потокобезопасность**
  - Блокирующий ввод в отдельном потоке
  - Синхронизация через AutoResetEvent
  - Безопасный доступ к UI

- **Визуальная обратная связь**
  - Автоматический фокус на TextBox при вводе
  - Отображение вводимых символов
  - Прокрутка к концу текста

## 6. Работа с файлами

### Открытие файлов

- **Диалог открытия**
  - Стандартный Windows диалог
  - Фильтр для .cs файлов
  - Поддержка всех файлов

- **Загрузка кода**
  - Автоматическая загрузка содержимого
  - Отображение в редакторе
  - Очистка консоли и графики

### Сохранение файлов

- **Диалог сохранения**
  - Стандартный Windows диалог
  - Предложение имени файла
  - Фильтр для .cs файлов

- **Сохранение кода**
  - Сохранение текущего содержимого редактора
  - Асинхронная операция
  - Обработка ошибок

### Новый файл

- **Создание нового файла**
  - Загрузка шаблонного кода
  - Очистка консоли и графики
  - Сброс состояния редактора

## 7. Многоязычный интерфейс

### Поддерживаемые языки

- **Русский (ru-RU)**
  - Полная локализация интерфейса
  - Локализованные сообщения об ошибках

- **Английский (en-US)**
  - Полная локализация интерфейса
  - Язык по умолчанию

- **Украинский (uk-UA)**
  - Полная локализация интерфейса

### Особенности

- **Динамическое переключение**
  - Изменение языка без перезапуска
  - Автоматическое обновление всех элементов UI
  - Сохранение выбранного языка в настройках

- **Локализация**
  - Все строки интерфейса
  - Сообщения об ошибках
  - Названия языков и тем

- **Fallback механизм**
  - Использование английского языка при отсутствии перевода
  - Отображение ключа при полном отсутствии строки

## 8. Темы оформления

### Доступные темы

- **Светлая тема (Light)**
  - Классическое светлое оформление
  - Высокий контраст
  - Подходит для дневного использования

- **Тёмная тема (Dark)**
  - Современное тёмное оформление
  - Снижение нагрузки на глаза
  - Подходит для вечернего использования

### Особенности

- **Динамическое переключение**
  - Изменение темы без перезапуска
  - Мгновенное применение
  - Сохранение выбранной темы в настройках

- **Элементы оформления**
  - Цвета окон и панелей
  - Цвета текста и заголовков
  - Стили кнопок
  - Цвета разделителей

## 9. Настройки приложения

### Сохраняемые настройки

- **Редактор**
  - Семейство шрифта
  - Размер шрифта
  - Язык подсветки синтаксиса

- **Интерфейс**
  - Тема оформления
  - Язык интерфейса

- **Шаблоны**
  - Шаблонный код при создании нового файла
  - Путь к файлу шаблона

### Хранение настроек

- **Файл настроек**
  - Расположение: `AppData/KID/settings.json`
  - Формат: JSON
  - Автоматическое сохранение при выходе

- **Значения по умолчанию**
  - Файл `DefaultWindowConfiguration.json`
  - Используется при первом запуске
  - Fallback при ошибках загрузки

## 10. Пользовательский интерфейс

### Главное окно

- **Кастомное оформление**
  - Окно без стандартных рамок Windows
  - Собственные кнопки управления (свернуть, развернуть, закрыть)
  - Перетаскивание за заголовок

- **Макет**
  - Заголовок с иконкой и названием
  - Меню внизу заголовка
  - Рабочая область с разделяемыми панелями

### Панели

- **Редактор кода**
  - Левая панель
  - Настраиваемый размер
  - Полноэкранный режим возможен

- **Консольный вывод**
  - Правая верхняя панель
  - Только для чтения (кроме ввода)
  - Автоматическая прокрутка

- **Графический вывод**
  - Правая нижняя панель
  - Минимальная высота 300px
  - Canvas для рисования

- **Разделители**
  - Горизонтальный между консолью и графикой
  - Вертикальный между редактором и выводом
  - Визуальная индикация возможности изменения размера

### Меню

- **Файл**
  - Новый файл
  - Открыть файл
  - Сохранить файл

- **Правка**
  - Отменить (Undo)
  - Повторить (Redo)
  - Состояние команд обновляется динамически

- **Вид**
  - Тема (подменю с выбором темы)
  - Сменить язык (подменю с выбором языка)

- **Запуск**
  - ▶️ Запустить
  - ■ Стоп (активна только во время выполнения)

## 11. Обработка ошибок

### Ошибки компиляции

- **Отображение**
  - Номер строки с ошибкой
  - Сообщение об ошибке
  - Локализованные сообщения

- **Обработка**
  - Программа не запускается при ошибках
  - Все ошибки отображаются в консоли
  - Форматирование: "Ошибка на строке {0}: {1}"

### Ошибки выполнения

- **Отображение**
  - Сообщение об ошибке
  - Стек вызовов
  - Локализованные сообщения

- **Обработка**
  - Программа останавливается
  - Вывод информации в консоль
  - Безопасное завершение

### Ошибки инициализации

- **Загрузка настроек**
  - Использование значений по умолчанию
  - Сообщение пользователю
  - Продолжение работы приложения

- **Загрузка шаблонов**
  - Использование встроенного шаблона
  - Сообщение пользователю
  - Продолжение работы приложения

## 12. Производительность

### Оптимизации

- **Асинхронные операции**
  - Компиляция в отдельном потоке
  - Выполнение в отдельном потоке
  - Неблокирующий UI

- **Кэширование**
  - Кэширование списка языков
  - Кэширование списка тем
  - Оптимизация загрузки ресурсов

- **UI синхронизация**
  - Использование BeginInvoke для неблокирующих операций
  - Приоритет Background для обновлений
  - Минимизация операций в UI потоке

## 13. Расширяемость

### Добавление новых функций

- **Новые методы Graphics API**
  - Добавление в соответствующие файлы
  - Следование паттерну InvokeOnUI
  - Документирование в Graphics-API.md

- **Новые языки**
  - Создание .resx файла
  - Добавление в AvailableLanguage
  - Обновление LocalizationService

- **Новые темы**
  - Создание XAML файла темы
  - Добавление в ThemeService
  - Обновление AvailableTheme

- **Новые сервисы**
  - Регистрация в DI контейнере
  - Создание интерфейса
  - Интеграция с существующими компонентами

## Примеры использования

### Простая программа
```csharp
using System;
using KID;

Console.WriteLine("Привет, Мир!");
Graphics.Color = "Blue";
Graphics.Circle(150, 150, 50);
```

### Интерактивная программа
```csharp
using System;
using KID;

Console.WriteLine("Введите ваше имя:");
string name = Console.ReadLine();
Console.WriteLine($"Привет, {name}!");

Graphics.Color = "Green";
Graphics.SetFont("Arial", 24);
Graphics.Text(50, 50, $"Привет, {name}!");
```

### Анимация
```csharp
using System;
using System.Threading;
using KID;

for (int i = 0; i < 100; i++)
{
    Graphics.Clear();
    Graphics.Color = "Red";
    Graphics.Circle(150 + i, 150, 30);
    Thread.Sleep(50);
}
```

### Воспроизведение звуков
```csharp
using System;
using KID;

// Простая мелодия
Music.Sound(
    new SoundNote(262, 500),  // До
    new SoundNote(294, 500),  // Ре
    new SoundNote(330, 500)   // Ми
);

// Полифонический аккорд
var track1 = new[] { new SoundNote(262, 2000) };  // До
var track2 = new[] { new SoundNote(330, 2000) };  // Ми
var track3 = new[] { new SoundNote(392, 2000) };  // Соль
Music.Sound(track1, track2, track3);

// Асинхронное воспроизведение файла
int soundId = Music.SoundPlay("background.mp3");
Music.SoundLoop(soundId, true);
```

## Заключение

.KID предоставляет полный набор функций для обучения программированию с визуальным выводом, консольным вводом/выводом и удобным интерфейсом. Все функции интегрированы и работают вместе для создания комфортной среды разработки для начинающих программистов.

